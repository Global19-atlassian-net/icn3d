iCn3DUI.prototype.drawGraph=function(e,t){var n=this;n.icn3d;"undefined"==typeof d3v4&&(d3v4=d3);var r=JSON.parse(e),i=$("#"+t).width(),s=$("#"+t).height(),o=1*i,a=1*s,u=i,l=s,c=d3.select("#"+n.svgid).attr("width",i).attr("height",s).attr("viewBox","0,0,"+o+","+a);c.selectAll(".g-main").remove();var d=c.append("g").classed("g-main",!0),h=d.append("rect").attr("width",u).attr("height",l).style("fill","#FFF"),f=d.append("g"),v=d3v4.zoom().on("zoom",function(){f.attr("transform",d3v4.event.transform)});if(d.call(v),r.links){for(var p=[],y={},g=0,m=r.nodes.length;g<m;++g){y[(N=r.nodes[g]).id]=1}var b=!1;for(g=0,m=r.links.length;g<m;++g){var w=r.links[g];y.hasOwnProperty(w.source)&&y.hasOwnProperty(w.target)?p.push(w):(y.hasOwnProperty(w.source)||console.log("The node "+w.source+" is not found... "),y.hasOwnProperty(w.target)||console.log("The node "+w.target+" is not found... "),b=!0)}b&&console.log(JSON.stringify(r)),r.links=p;var x={};for(g=0;g<r.nodes.length;g++)n.force||(r.nodes[g].x*=10,r.nodes[g].y*=10),x[r.nodes[g].id]=r.nodes[g],r.nodes[g].weight=1.01;if(n.hideedges&&!n.force){var k=[];for(g=0;g<r.links.length;g++)"FFF"!=r.links[g].c&&k.push(r.links[g]);r.links=k}var V=f.append("g"),I=null,_=(w=f.append("g").attr("class","link").selectAll("line").data(r.links).enter().append("line").attr("stroke",function(e){return e.v==n.contactInsideValue?"#"+n.contactInsideColor:e.v==n.hbondInsideValue?"#"+n.hbondInsideColor:e.v==n.ionicInsideValue?"#"+n.ionicInsideColor:e.v==n.halogenInsideValue?"#"+n.halogenInsideColor:e.v==n.picationInsideValue?"#"+n.picationInsideColor:e.v==n.pistackingInsideValue?"#"+n.pistackingInsideColor:"#"+e.c}).attr("stroke-width",function(e){return e.v==n.contactValue||e.v==n.contactInsideValue||e.v==n.hbondInsideValue||e.v==n.ionicInsideValue||e.v==n.halogenInsideValue||e.v==n.picationInsideValue||e.v==n.pistackingInsideValue?"1px":e.v==n.hbondValue||e.v==n.ionicValue||e.v==n.halogenValue||e.v==n.picationValue||e.v==n.pistackingValue?"2px":e.v==n.ssbondValue||e.v==n.clbondValue?"3px":e.v+"px"}),f.append("g").attr("class","node")),N=_.selectAll("circle").data(r.nodes).enter().append("circle").attr("r",3).attr("fill",function(e){return"#"+e.c}).attr("stroke",function(e){return"#"+e.c}).attr("res",function(e){return e.r}).attr("class","icn3d-node").call(d3v4.drag().on("start",function(e){d3v4.event.active||n.simulation.alphaTarget(.9).restart();e.selected||q||N.classed("selected",function(e){return e.selected=e.previouslySelected=!1});d3v4.select(this).classed("selected",function(t){return e.previouslySelected=e.selected,e.selected=!0}),N.filter(function(e){return e.selected}).each(function(e){e.fx=e.x,e.fy=e.y})}).on("drag",function(e){N.filter(function(e){return e.selected}).each(function(e){e.fx+=d3v4.event.dx,e.fy-=d3v4.event.dy})}).on("end",function(e){d3v4.event.active||n.simulation.alphaTarget(0);e.fx=null,e.fy=null,N.filter(function(e){return e.selected}).each(function(e){e.fx=null,e.fy=null})})),M=_.selectAll("text").data(r.nodes).enter().append("text").text(function(e){var t=e.id,n=t.indexOf(".");return-1!==n&&(t=t.substr(0,n)),t}).attr("fill",function(e){return"#"+e.c}).attr("stroke","none").attr("class","icn3d-node-text8");N.append("title").text(function(e){return e.id});var S=parseInt($("#"+n.pre+"dist_ss").val()),C=parseInt($("#"+n.pre+"dist_coil").val()),z=parseInt($("#"+n.pre+"dist_hbond").val()),A=parseInt($("#"+n.pre+"dist_inter").val()),O=parseInt($("#"+n.pre+"dist_ssbond").val()),P=parseInt($("#"+n.pre+"dist_ionic").val()),T=parseInt($("#"+n.pre+"dist_halogen").val()),E=parseInt($("#"+n.pre+"dist_pication").val()),F=parseInt($("#"+n.pre+"dist_pistacking").val());n.simulation=d3v4.forceSimulation().force("link",d3v4.forceLink().id(function(e){return e.id}).distance(function(e){return 30}).strength(function(e){return n.force?e.v==n.ssValue?isNaN(S)?1:S/100:e.v==n.coilValue||e.v==n.clbondValue?isNaN(C)?.5:C/100:e.v==n.hbondValue||e.v==n.hbondInsideValue?isNaN(z)?.5:z/100:e.v==n.contactValue||e.v==n.contactInsideValue?isNaN(A)?.25:A/100:e.v==n.ssbondValue?isNaN(O)?.5:O/100:e.v==n.ionicValue||e.v==n.ionicInsideValue?isNaN(P)?.5:P/100:e.v==n.halogenValue||e.v==n.halogenInsideValue?isNaN(T)?.5:T/100:e.v==n.picationValue||e.v==n.picationInsideValue?isNaN(E)?.5:E/100:e.v==n.pistackingValue||e.v==n.pistackingInsideValue?isNaN(F)?.5:F/100:0:0})).force("center",d3v4.forceCenter(u/2,l/2)),n.force&&n.simulation.force("charge",d3v4.forceManyBody()),1==n.force?n.simulation.force("x",d3v4.forceX(function(e){return"a"==e.s?u/4:.75*u}).strength(function(e){return.4})).force("y",d3v4.forceY(l/2).strength(function(e){return.02})):2==n.force?n.simulation.force("y",d3v4.forceY(function(e){return"a"==e.s?.75*l:l/4}).strength(function(e){return.4})).force("x",d3v4.forceX(u/2).strength(function(e){return.02})):3==n.force?n.simulation.force("r",d3v4.forceRadial(function(e){return"a"==e.s?200:100},u/2,l/2).strength(function(e){return.8})):n.force,n.simulation.nodes(r.nodes).on("tick",function(){w.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return l-e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return l-e.target.y}),N.attr("cx",function(e){return e.x}).attr("cy",function(e){return l-e.y}),M.attr("x",function(e){return e.x+6}).attr("y",function(e){return l-(e.y+3)})}),n.simulation.force("link").links(r.links);var q,D=!1,K=!1,G=d3v4.brush().on("start",function(){K=!0,N.each(function(e){e.previouslySelected=q&&e.selected})}).on("brush",function(){if(!d3v4.event.sourceEvent)return;if(!d3v4.event.selection)return;var e=d3v4.event.selection;N.classed("selected",function(t){return t.selected=t.previouslySelected^(e[0][0]<=t.x&&t.x<e[1][0]&&e[0][1]<=l-t.y&&l-t.y<e[1][1])})}).on("end",function(){if(!d3v4.event.sourceEvent)return;if(!d3v4.event.selection)return;if(!I)return;I.call(G.move,null),D||(I.remove(),I=null);K=!1});return h.on("click",function(){N.each(function(e){e.selected=!1,e.previouslySelected=!1}),N.classed("selected",!1)}),d3v4.select("body").on("keydown",function(){if(q=d3v4.event.ctrlKey){if(I)return;D=!0,I||(I=V.append("g")).call(G)}}),d3v4.select("body").on("keyup",function(){if(q=!1,D=!1,!I)return;K||(I.remove(),I=null)}),r}console.log("Graph is missing links")},iCn3DUI.prototype.copyStylesInline=function(e,t){this.icn3d;for(var n=["svg","g"],r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(-1==n.indexOf(i.tagName)){var s=t.childNodes[r].currentStyle||window.getComputedStyle(t.childNodes[r]);if("undefined"!=s&&null!=s)for(var o=0;o<s.length;o++)i.style.setProperty(s[o],s.getPropertyValue(s[o]))}else this.copyStylesInline(i,t.childNodes[r])}},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],t):t(e.d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,t,n,r,i,s){"use strict";var o=function(e){return function(){return e}},a=function(e,t,n){this.target=e,this.type=t,this.selection=n};function u(){i.event.stopImmediatePropagation()}var l=function(){i.event.preventDefault(),i.event.stopImmediatePropagation()},c={name:"drag"},d={name:"space"},h={name:"handle"},f={name:"center"},v={name:"x",handles:["e","w"].map(k),input:function(e,t){return e&&[[e[0],t[0][1]],[e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},p={name:"y",handles:["n","s"].map(k),input:function(e,t){return e&&[[t[0][0],e[0]],[t[1][0],e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},y={name:"xy",handles:["n","e","s","w","nw","ne","se","sw"].map(k),input:function(e){return e},output:function(e){return e}},g={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},m={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},b={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},w={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},x={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function k(e){return{type:e}}function V(){return!i.event.button}function I(){var e=this.ownerSVGElement||this;return[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function _(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function N(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function M(e){var y,M=I,S=V,C=t.dispatch(A,"start","brush","end"),z=6;function A(t){var n=t.property("__brush",E).selectAll(".overlay").data([k("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",g.overlay).merge(n).each(function(){var e=_(this).extent;i.select(this).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1])}),t.selectAll(".selection").data([k("selection")]).enter().append("rect").attr("class","selection").attr("cursor",g.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=t.selectAll(".handle").data(e.handles,function(e){return e.type});r.exit().remove(),r.enter().append("rect").attr("class",function(e){return"handle handle--"+e.type}).attr("cursor",function(e){return g[e.type]}),t.each($).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",T)}function $(){var e=i.select(this),t=_(this).selection;t?(e.selectAll(".selection").style("display",null).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1]),e.selectAll(".handle").style("display",null).attr("x",function(e){return"e"===e.type[e.type.length-1]?t[1][0]-z/2:t[0][0]-z/2}).attr("y",function(e){return"s"===e.type[0]?t[1][1]-z/2:t[0][1]-z/2}).attr("width",function(e){return"n"===e.type||"s"===e.type?t[1][0]-t[0][0]+z:z}).attr("height",function(e){return"e"===e.type||"w"===e.type?t[1][1]-t[0][1]+z:z})):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function O(e,t){return e.__brush.emitter||new P(e,t)}function P(e,t){this.that=e,this.args=t,this.state=e.__brush,this.active=0}function T(){if(i.event.touches){if(i.event.changedTouches.length<i.event.touches.length)return l()}else if(y)return;if(S.apply(this,arguments)){var t,r,o,a,k,V,I,M,C,z,A,P,T,E=this,F=i.event.target.__data__.type,q="selection"===(i.event.metaKey?F="overlay":F)?c:i.event.altKey?f:h,D=e===p?null:w[F],K=e===v?null:x[F],G=_(E),X=G.extent,Y=G.selection,j=X[0][0],B=X[0][1],J=X[1][0],U=X[1][1],L=i.mouse(E),R=L,H=O(E,arguments).beforestart();"overlay"===F?G.selection=Y=[[t=e===p?j:L[0],o=e===v?B:L[1]],[k=e===p?J:t,I=e===v?U:o]]:(t=Y[0][0],o=Y[0][1],k=Y[1][0],I=Y[1][1]),r=t,a=o,V=k,M=I;var Q=i.select(E).attr("pointer-events","none"),W=Q.selectAll(".overlay").attr("cursor",g[F]);if(i.event.touches)Q.on("touchmove.brush",ee,!0).on("touchend.brush touchcancel.brush",ne,!0);else{var Z=i.select(i.event.view).on("keydown.brush",function(){switch(i.event.keyCode){case 18:q===h&&(D&&(k=V-C*D,t=r+C*D),K&&(I=M-z*K,o=a+z*K),q=f,te());break;case 32:q!==h&&q!==f||(D<0?k=V-C:D>0&&(t=r-C),K<0?I=M-z:K>0&&(o=a-z),q=d,W.attr("cursor",g.selection),te());break;default:return}l()},!0).on("keyup.brush",function(){switch(i.event.keyCode){case 18:q===f&&(D<0?k=V:D>0&&(t=r),K<0?I=M:K>0&&(o=a),q=h,te());break;case 32:q===d&&(i.event.altKey?(D&&(k=V-C*D,t=r+C*D),K&&(I=M-z*K,o=a+z*K),q=f):(D<0?k=V:D>0&&(t=r),K<0?I=M:K>0&&(o=a),q=h),W.attr("cursor",g[F]),te());break;default:return}l()},!0).on("mousemove.brush",ee,!0).on("mouseup.brush",ne,!0);n.dragDisable(i.event.view)}u(),s.interrupt(E),$.call(E),H.start()}function ee(){var e=i.mouse(E);R=e,A=!0,l(),te()}function te(){var e;switch(C=R[0]-L[0],z=R[1]-L[1],q){case d:case c:D&&(C=Math.max(j-t,Math.min(J-k,C)),r=t+C,V=k+C),K&&(z=Math.max(B-o,Math.min(U-I,z)),a=o+z,M=I+z);break;case h:D<0?(C=Math.max(j-t,Math.min(J-t,C)),r=t+C,V=k):D>0&&(C=Math.max(j-k,Math.min(J-k,C)),r=t,V=k+C),K<0?(z=Math.max(B-o,Math.min(U-o,z)),a=o+z,M=I):K>0&&(z=Math.max(B-I,Math.min(U-I,z)),a=o,M=I+z);break;case f:D&&(r=Math.max(j,Math.min(J,t-C*D)),V=Math.max(j,Math.min(J,k+C*D))),K&&(a=Math.max(B,Math.min(U,o-z*K)),M=Math.max(B,Math.min(U,I+z*K)))}V<r&&(D*=-1,e=t,t=k,k=e,e=r,r=V,V=e,F in m&&W.attr("cursor",g[F=m[F]])),M<a&&(K*=-1,e=o,o=I,I=e,e=a,a=M,M=e,F in b&&W.attr("cursor",g[F=b[F]])),G.selection&&(Y=G.selection),P&&(r=Y[0][0],V=Y[1][0]),T&&(a=Y[0][1],M=Y[1][1]),Y[0][0]===r&&Y[0][1]===a&&Y[1][0]===V&&Y[1][1]===M||(G.selection=[[r,a],[V,M]],$.call(E),H.brush())}function ne(){if(u(),i.event.touches){if(i.event.touches.length)return;y&&clearTimeout(y),y=setTimeout(function(){y=null},500),Q.on("touchmove.brush touchend.brush touchcancel.brush",null)}else n.dragEnable(i.event.view,A),Z.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);Q.attr("pointer-events","all"),W.attr("cursor",g.overlay),G.selection&&(Y=G.selection),N(Y)&&(G.selection=null,$.call(E)),H.end()}}function E(){var t=this.__brush||{selection:null};return t.extent=M.apply(this,arguments),t.dim=e,t}return A.move=function(t,n){t.selection?t.on("start.brush",function(){O(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){O(this,arguments).end()}).tween("brush",function(){var t=this,i=t.__brush,s=O(t,arguments),o=i.selection,a=e.input("function"==typeof n?n.apply(this,arguments):n,i.extent),u=r.interpolate(o,a);function l(e){i.selection=1===e&&N(a)?null:u(e),$.call(t),s.brush()}return o&&a?l:l(1)}):t.each(function(){var t=arguments,r=this.__brush,i=e.input("function"==typeof n?n.apply(this,t):n,r.extent),o=O(this,t).beforestart();s.interrupt(this),r.selection=null==i||N(i)?null:i,$.call(this),o.start().brush().end()})},P.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(t){i.customEvent(new a(A,t,e.output(this.state.selection)),C.apply,C,[t,this.that,this.args])}},A.extent=function(e){return arguments.length?(M="function"==typeof e?e:o([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),A):M},A.filter=function(e){return arguments.length?(S="function"==typeof e?e:o(!!e),A):S},A.handleSize=function(e){return arguments.length?(z=+e,A):z},A.on=function(){var e=C.on.apply(C,arguments);return e===C?A:e},A}e.brush=function(){return M(y)},e.brushX=function(){return M(v)},e.brushY=function(){return M(p)},e.brushSelection=function(e){var t=e.__brush;return t?t.dim.output(t.selection):null},Object.defineProperty(e,"__esModule",{value:!0})});